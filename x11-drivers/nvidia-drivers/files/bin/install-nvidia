#!/bin/bash

. /usr/share/coreos/release
NVIDIA_DRIVER_BASENAME="$1"
KERNEL_NAME="$(ls /lib/modules)"

cd "/nvidia/${NVIDIA_DRIVER_BASENAME}"
./nvidia-installer -s -n \
  --no-check-for-alternate-installs \
  --no-kernel-module-source \
  --kernel-name="${KERNEL_NAME}" \
  --no-opengl-files \
  --no-distro-scripts \
  --no-systemd \
  --skip-depmod \
  --kernel-install-path="${PWD}" \
  --log-file-name="${PWD}/nvidia-installer.log" || true
